---
import BaseLayout from '@/layouts/BaseLayout.astro';
import CategoryFilter from '@/components/blog/CategoryFilter';
import Newsletter from '@/components/sections/Newsletter';
import { getAllCategories } from '@/lib/blog';

interface Props {
  title: string;
  description: string;
  image?: string;
  currentCategory?: string;
}

const { title, description, image, currentCategory } = Astro.props;

// Fetch all categories for the sidebar
const categories = await getAllCategories();
---

<BaseLayout title={title} description={description} image={image}>
  <main class="pt-8 pb-16">
    <div class="container px-4 sm:px-6 lg:px-8 mx-auto">
      <div class="flex flex-col lg:flex-row lg:gap-10">
        <!-- Main Content -->
        <div class="w-full lg:w-2/3 lg:order-1">
          <slot />
        </div>

        <!-- Sidebar -->
        <aside class="w-full lg:w-1/3 mt-10 lg:mt-0 lg:order-2">
          <div class="sticky top-24 space-y-8">
            <!-- Category Filter -->
            <div class="bg-white rounded-xl p-6 border border-mountain-green/20 shadow-sm">
              <CategoryFilter categories={categories} currentCategory={currentCategory} client:load />
            </div>
            
            <!-- Newsletter Subscribe -->
            <div class="bg-white rounded-xl p-6 border border-mountain-green/20 shadow-sm">
              <div class="mb-4">
                <h3 class="font-heading font-bold text-lg text-dark-slate mb-2">Get Monthly Updates</h3>
                <p class="text-sm text-dark-slate/80">Subscribe to our newsletter and never miss out on our latest insights.</p>
              </div>
              <!-- We'll use a simplified newsletter form here -->
              <form 
                action="https://api.new.website/api/submit-form/"
                method="POST"
                enctype="multipart/form-data"
                class="space-y-3"
              >
                <input type="hidden" name="form_name" value="Newsletter Signup" />
                <input type="hidden" name="form_type" value="newsletter" />
                <div>
                  <label for="sidebar-email" class="sr-only">Email address</label>
                  <input 
                    type="email" 
                    name="email"
                    id="sidebar-email"
                    placeholder="Your email address"
                    class="w-full px-4 py-3 rounded-lg border border-mountain-green/30 text-dark-slate placeholder:text-dark-slate/60 focus:outline-none focus:ring-2 focus:ring-blue-mell"
                    required
                  />
                </div>
                <button 
                  type="submit"
                  class="w-full py-3 px-4 bg-dark-slate text-white font-medium rounded-lg hover:bg-blue-mell transition-colors duration-200 flex items-center justify-center"
                >
                  Subscribe
                </button>
              </form>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </main>
  <Newsletter />
</BaseLayout>